#!/system/bin/sh

if /system/bin/curl -sL ipinfo.io | grep 'CN' > /dev/null 2>&1; then
    script_url="https://mirror.ghproxy.com/https://raw.githubusercontent.com/daboynb/PlayIntegrityNEXT/main/Fp_Downloader.apk%20to%20use%20with%20play%20integrity%20by%20chiteroman/fpt.sh"
else
    script_url="https://raw.githubusercontent.com/daboynb/PlayIntegrityNEXT/main/Fp_Downloader.apk%20to%20use%20with%20play%20integrity%20by%20chiteroman/fpt.sh"
fi

local_script_path="/storage/emulated/0/fpt.sh"

# Download the script 
/system/bin/curl -L "$script_url" -o "$local_script_path" > /dev/null 2>&1

# Check if the download was successful 
if [ $? -eq 0 ]; then
    echo "Download successful. Executing the script..."
    sleep 02 
    clear
    /system/bin/sh "$local_script_path"
else
    echo "Download failed. Please check the network connection."
    # Download it again without suppressing the output to catch the error
    /system/bin/curl -L "$script_url" -o "$local_script_path"
fi